<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Usuario</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <style>
        body {
            background-color: #a9def9;
        }
        .sidebar {
            height: 100vh;
            width: 250px;
            position: fixed;
            left: 0;
            top: 0;
            background: #013a63;
            color: white;
            padding-top: 20px;
        }
        .sidebar a {
            color: white;
            text-decoration: none;
            padding: 10px;
            display: block;
        }
        .sidebar a:hover {
            background-color: #a9def9;
        }
        .user-icon {
            font-size: 50px;
        }
        .main-content {
            flex-grow: 1;
            margin-left: 250px;
            padding: 30px;
        }
    </style>
</head>
<body>

    <!-- Barra lateral -->
    <div class="sidebar">
        <div class="text-center">
            <span class="user-icon">üë®‚Äçüéì</span>
            <h4>{{ request.session.nombre_usuario }}</h4>
        <span class="badge bg-success mt-2">Alumno</span>  <!-- NUEVA L√çNEA -->
        </div>
        <hr>
        <a href="{% url 'dashboard_usuario' %}">üè† Inicio</a>
        <a href="{% url 'seleccion_tipo_texto' %}" class="text-primary">üìñ Iniciar evaluaci√≥n</a>
        <a href="{% url 'resultados_usuario' %}">üìä Mis resultados de evaluaci√≥n</a>
        <a href="{% url 'logout_usuario' %}" >üö™ Cerrar sesi√≥n</a>
    </div>
<!-- Contenido principal -->
<div class="main-content">
    <h2>Bienvenido, {{ nombre }}</h2>
    <p>Este es tu panel de control. Usa el men√∫ a la izquierda para comenzar tu evaluaci√≥n o revisar tus resultados.</p>

    {% if messages %}
        {% for message in messages %}
            <div class="alert alert-{{ message.tags }} mt-3">{{ message }}</div>
        {% endfor %}
    {% endif %}

    <h4 class="mt-5 text-center">Tu desempe√±o en comprensi√≥n lectora</h4>

    {% if nivel_global %}
    <div id="nivel-global-card" class="mt-4 fw-bold text-center text-white px-4 py-3 rounded" style="width: fit-content; margin: auto;">
        Nivel actual: {{ nivel_global }}
    </div>
{% endif %}

    <canvas id="graficaGlobal" height="120"></canvas>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    {{ meses|json_script:"meses-data" }}
    {{ porcentajes|json_script:"porcentajes-data" }}
    
    <script>
        const meses = JSON.parse(document.getElementById("meses-data").textContent);
        const porcentajes = JSON.parse(document.getElementById("porcentajes-data").textContent);
    
        const backgroundColors = porcentajes.map(p => {
            if (p >= 90) return 'rgba(0, 200, 83, 0.6)';
            if (p >= 60) return 'rgba(255, 206, 86, 0.6)';
            if (p >= 30) return 'rgba(255, 159, 64, 0.6)';
            return 'rgba(255, 99, 132, 0.6)';
        });
    
        const borderColors = backgroundColors.map(c => c.replace("0.6", "1"));
    
        const ctx = document.getElementById("graficaGlobal").getContext("2d");
    
        new Chart(ctx, {
            type: 'bar',
            data: {
                labels: meses,
                datasets: [{
                    data: porcentajes,
                    backgroundColor: backgroundColors,
                    borderColor: borderColors,
                    borderWidth: 2
                }]
            },
            options: {
                plugins: {
                    legend: { display: false },
                    tooltip: {
                        callbacks: {
                            label: ctx => `Porcentaje: ${ctx.parsed.y}%`
                        }
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        max: 100,
                        ticks: {
                            stepSize: 10,
                            color: "#000",
                            font: { weight: "bold" }
                        },
                        title: {
                            display: true,
                            text: "Porcentaje (%)",
                            font: { weight: "bold" }
                        }
                    },
                    x: {
                        ticks: {
                            color: "#000",
                            font: { weight: "bold" }
                        },
                        title: {
                            display: true,
                            text: "Mes",
                            font: { weight: "bold" }
                        }
                    }
                }
            }
        });
    
        // Cambiar color autom√°tico de la tarjeta
        const nivelTexto = "{{ nivel_global }}".toLowerCase();
        const card = document.getElementById("nivel-global-card");
    
        if (card) {
            let color = "#9e9e9e";
    
            if (nivelTexto.includes("alto")) color = "#00c853";
            else if (nivelTexto.includes("medio")) color = "#ffca28";
            else if (nivelTexto.includes("bajo")) color = "#ff9800";
            else if (nivelTexto.includes("deficiente")) color = "#e53935";
    
            card.style.backgroundColor = color;
        }
    </script>    
</div>
</body>
</html>


